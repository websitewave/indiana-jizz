# Indiana Jizz

**Indiana Jizz** - простая Docker-сборка для PHP-приложений с использованием Apache, PHP-FPM, MySQL и phpMyAdmin.

Сборка предназначена для использования в качестве модуля в ваших проектах, что позволяет обновлять её независимо от вашего основного кода.

---

## Особенности

- **Apache 2.4** с поддержкой PHP через PHP-FPM
- **PHP 8.0-FPM** с необходимыми расширениями
- **MySQL 5.7** для работы с базами данных
- **phpMyAdmin** для удобного управления базой данных
- **Docker Compose** для простого управления сервисами
- **Монтирование директории с исходным кодом** для удобной разработки

---

## Требования

- **Docker** версии 19.03 или выше
- **Docker Compose** версии 1.25 или выше
- **Git** для работы с репозиториями и подмодулями
- **WSL 2 (Windows Subsystem for Linux)**, если вы используете Windows

---

## Установка и настройка

Ниже приведены пошаговые инструкции по интеграции этой Docker-сборки в ваш проект. Следуйте им внимательно, даже если вы новичок в Docker или Git.

### Шаг 1: Создайте папку для вашего проекта

Если у вас ещё нет папки для вашего проекта, создайте её:

```bash
# В домашней директории создаём папку проекта
cd ~
mkdir my-awesome-project
cd my-awesome-project
```

### Шаг 2: Инициализируйте Git-репозиторий

Инициализируйте новый Git-репозиторий в папке вашего проекта:

`git init`

### Шаг 3: Добавьте Docker-сборку как подмодуль

Добавьте этот репозиторий в ваш проект в качестве подмодуля:

`git submodule add https://github.com/websitewave/indiana-jizz.git docker`

Это создаст папку `docker` внутри вашего проекта, содержащую все файлы Docker-сборки.

### Шаг 4: Структура вашего проекта

Теперь ваша файловая структура должна выглядеть следующим образом:

    my-awesome-project/
    ├── docker/                # подмодуль с Docker-сборкой
    │   ├── docker-compose.yml
    │   ├── .env
    │   └── docker/            # папка с Dockerfile и конфигурациями
    ├── source/                # ваши файлы приложения
    ├── README.md
    └── .gitignore
    

Папка `source`, где будет находиться ваш PHP-код, будет создана при запуске билда.

### Шаг 5: Настройте переменные окружения

Перейдите в папку `docker` и отредактируйте файл `.env`:

Откройте файл `.env` в текстовом редакторе и добавьте следующие строки:

    COMPOSE_PROJECT_NAME=your_project_name

    MYSQL_ROOT_PASSWORD=your_root_password
    MYSQL_DATABASE=your_database
    MYSQL_USER=your_user
    MYSQL_PASSWORD=your_password

**Важно:** Замените `your_root_password`, `your_database`, `your_user` и `your_password` на реальные значения, которые вы хотите использовать для вашей базы данных MySQL.

**Обязательно:** Замените значение переменный `COMPOSE_PROJECT_NAME` на название своего проекта во избежание ошибок.

### Шаг 6: Запустите Docker-сборку

Находясь в папке `docker`, выполните команду:

`docker-compose up -d --build`

*   `docker-compose up`: Запускает контейнеры, определённые в `docker-compose.yml`.
*   `-d`: Запускает контейнеры в фоновом режиме (detached mode).
*   `--build`: Собирает образы Docker перед запуском контейнеров.

Подождите, пока Docker загрузит необходимые образы и запустит контейнеры. Это может занять несколько минут при первом запуске.

Затем будет создана папка `source` куда вы можете поместить файлы вашего сайта\приложения

### Шаг 7: Проверьте работу сервисов

#### 7.1 Доступ к веб-приложению

Откройте браузер и перейдите по адресу:

    http://localhost
    

Если всё настроено правильно, вы должны увидеть содержимое вашего `index.php`, находящегося в папке `source`.

#### 7.2 Доступ к phpMyAdmin

Для управления базой данных MySQL через веб-интерфейс перейдите по адресу:

    http://localhost:8080
    

Войдите, используя ваши учетные данные из файла `.env`.

* * *

Команды для управления Docker-контейнерами
------------------------------------------

### Остановка контейнеров

Чтобы остановить все запущенные контейнеры:

`docker-compose down`

### Перезапуск контейнеров

Чтобы запустить контейнеры снова:

`docker-compose up -d`

### Пересборка контейнеров

Если вы внесли изменения в `Dockerfile` или конфигурационные файлы, пересоберите образы:

`docker-compose up -d --build`

### Просмотр логов

Вы можете просмотреть логи от разных сервисов для отладки.

#### Логи Apache:

`docker logs apache`

#### Логи PHP-FPM:

`docker logs php`

#### Логи MySQL:

`docker logs mysql`

* * *

Обновление Docker-сборки
------------------------

Если Docker-сборка (`indiana-jizz`) была обновлена, и вы хотите получить эти обновления в вашем проекте, выполните следующие шаги.

### Шаг 1: Перейдите в папку подмодуля

`cd docker`

### Шаг 2: Получите обновления из удалённого репозитория

`git pull origin master`

### Шаг 3: Вернитесь в корневую папку проекта

`cd ..`

### Шаг 4: Зафиксируйте изменения подмодуля в вашем основном репозитории

`git add docker git commit -m "Update Docker submodule" git push`

* * *

Клонирование вашего проекта с подмодулями
-----------------------------------------

Когда вы или кто-то другой будет клонировать ваш проект, содержащий подмодули, используйте следующую команду:

`git clone --recurse-submodules https://github.com/yourusername/my-awesome-project.git`

Если вы уже клонировали репозиторий без подмодулей, инициализируйте и обновите их:

`git submodule init git submodule update`

* * *

Альтернатива подмодулям: Использование Git Subtree
--------------------------------------------------

Если вы предпочитаете не использовать подмодули, вы можете интегрировать Docker-сборку с помощью Git Subtree.

### Добавление Docker-сборки с помощью Subtree

`git subtree add --prefix=docker https://github.com/websitewave/indiana-jizz.git master --squash`

### Обновление Docker-сборки

`git subtree pull --prefix=docker https://github.com/websitewave/indiana-jizz.git master --squash`

* * *

Настройка PHP и Apache
----------------------

### Добавление дополнительных PHP-расширений

Если вашему приложению требуются дополнительные PHP-расширения, откройте файл `docker/php/Dockerfile` и добавьте необходимые команды установки:

`RUN docker-php-ext-install your_extension`

Затем пересоберите контейнеры:

`docker-compose up -d --build`

### Настройка `php.ini`

Измените настройки PHP, отредактировав файл `docker/php/php.ini`.

### Настройка Apache

Измените конфигурацию Apache в файле `docker/apache/httpd.conf` или соответствующем `Dockerfile`.

* * *

Работа с WSL 2 (для пользователей Windows)
------------------------------------------

Если вы используете Windows с WSL 2, рекомендуется хранить файлы проекта внутри файловой системы WSL для лучшей производительности и корректного монтирования директорий.

### Перемещение проекта в файловую систему WSL

1.  **Создайте директорию для проектов внутри WSL:**
    
    `mkdir -p ~/projects`
    
2.  **Переместите ваш проект в эту директорию:**
    
    `mv /mnt/c/путь/к/вашему/проекту ~/projects/my-awesome-project`
    
3.  **Перейдите в директорию проекта:**
    
    `cd ~/projects/my-awesome-project`
    

### Обновление путей в `docker-compose.yml`

Убедитесь, что в `docker-compose.yml` пути к файлам соответствуют реальным путям внутри WSL.

* * *

Решение возможных проблем
-------------------------

### Проблемы с правами доступа

Если Docker-контейнеры не имеют доступа к вашим файлам, убедитесь, что у них есть необходимые права.

*   Проверьте права доступа к папке `source`.
*   Убедитесь, что файлы доступны для чтения и записи.

### Порты заняты другими приложениями

Если порты `80` или `3306` заняты, измените их в файле `docker-compose.yml`:

`services:   apache:     ports:       - "8080:80"    # Измените на доступный порт   mysql:     ports:       - "3307:3306"  # Измените на доступный порт`

### Проблемы с монтированием директорий

Если файлы из папки `source` не отображаются в контейнере:

*   Убедитесь, что вы работаете внутри файловой системы WSL.
*   Проверьте корректность путей в `docker-compose.yml`.

* * *

Контактная информация
---------------------

Если у вас возникли вопросы или вы столкнулись с проблемами, пожалуйста, создайте [Issue](https://github.com/websitewave/indiana-jizz/issues) на GitHub или свяжитесь со мной по электронной почте: [alex.websitewave@gmail.com](mailto:alex.websitewave@gmail.com).

* * *

Лицензия
--------

Этот проект лицензирован на условиях лицензии MIT. Подробнее см. в файле [LICENSE](LICENSE).
